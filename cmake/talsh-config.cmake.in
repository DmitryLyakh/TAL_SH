cmake_minimum_required(VERSION 3.18.0 FATAL_ERROR)

@PACKAGE_INIT@

set(USE_HIP @USE_HIP@)
set(TALSH_GPU @TALSH_GPU@)
set(USE_OPENMP @USE_OPENMP@) 
set(WITH_CUTENSOR @WITH_CUTENSOR@)
set(TALSH_GPU_ARCH @TALSH_GPU_ARCH@)
set(TALSH_FINE_TIMING @TALSH_FINE_TIMING@)

enable_language(Fortran)

# include( CMakeFindDependencyMacro )
if(USE_OPENMP)
    find_package(OpenMP REQUIRED)
endif()

if(TALSH_GPU)
    if(USE_HIP)
        set(ROCM_ROOT @ROCM_ROOT@)
        if(TALSH_GPU_ARCH)
            set(GPU_TARGETS ${TALSH_GPU_ARCH} CACHE STRING "GPU targets to compile for")
        endif()
		list(PREPEND CMAKE_MODULE_PATH ${ROCM_ROOT} ${ROCM_ROOT}/hip ${ROCM_ROOT}/hipblas)
		find_package(hip REQUIRED)
		find_package(hipblas REQUIRED)
        list(REMOVE_AT CMAKE_MODULE_PATH 0)
    else()
        enable_language(CUDA)
        find_package(CUDAToolkit REQUIRED COMPONENTS cublas)
    endif()
endif() 

if(NOT TARGET talsh::talsh)
    include("${CMAKE_CURRENT_LIST_DIR}/talsh-targets.cmake")
endif()

set(TALSH_FOUND TRUE)
set(TALSH_LIBRARIES talsh::talsh)
set(TALSH_INCLUDE_DIRS "@PACKAGE_CMAKE_INSTALL_INCLUDEDIR@")

if(TALSH_FINE_TIMING)
    list(APPEND TALSH_COMPILE_DEFINITIONS GPU_FINE_TIMING)
endif()

if(TALSH_GPU AND WITH_CUTENSOR)
    set(CUTENSOR_ROOT @CUTENSOR_ROOT@)
    list(APPEND TALSH_COMPILE_DEFINITIONS USE_CUTENSOR)
    list(APPEND TALSH_INCLUDE_DIRS ${CUTENSOR_ROOT}/include)
endif()

if(TALSH_GPU)
    list(APPEND TALSH_COMPILE_DEFINITIONS USE_TALSH)
    if(USE_HIP)
        list(APPEND TALSH_COMPILE_DEFINITIONS USE_HIP)
        #set(HIP_LIBRARIES @HIP_LIBRARIES@)
        set(HIP_INCLUDE_DIRS @HIP_INCLUDE_DIRS@)
        set(HIPBLAS_INCLUDE_DIRS @HIPBLAS_INCLUDE_DIRS@)
        list(APPEND TALSH_INCLUDE_DIRS ${HIP_INCLUDE_DIRS} ${HIPBLAS_INCLUDE_DIRS})
        list(APPEND TALSH_LIBRARIES hip::device)
    else()
        list(APPEND TALSH_INCLUDE_DIRS ${CUDAToolkit_INCLUDE_DIRS})
    endif()
endif()
